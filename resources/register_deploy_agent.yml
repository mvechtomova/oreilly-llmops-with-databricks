resources:
  jobs:
    register_deploy_agent:
      name: arxiv-agent-register-deploy-pipeline
      tags:
        project_name: "arxiv-curator"
      environments:
        - environment_key: default
          spec:
            environment_version: "4"
            dependencies:
              - ../dist/*.whl

      tasks:
        - task_key: log_register_agent
          environment_key: default
          notebook_task:
            notebook_path: deployment_notebooks/log_register_agent.py
            base_parameters:
              env: ${bundle.target}
              git_sha: "${var.git_sha}"
              run_id: "{{job.run_id}}"

        - task_key: deploy_agent
          environment_key: default
          depends_on:
            - task_key: log_register_agent
          notebook_task:
            notebook_path: deployment_notebooks/deploy_agent.py
            base_parameters:
              env: ${bundle.target}
              git_sha: "${var.git_sha}"
